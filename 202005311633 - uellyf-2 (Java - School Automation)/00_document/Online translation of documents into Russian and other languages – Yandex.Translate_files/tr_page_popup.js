!function(n,s,t){"use strict";function i(t,e){for(;t&&t.nodeType===Node.ELEMENT_NODE;){if(e(t))return t;t=t.parentNode}return null}function a(t){this._element=t,this._pointer={x:0,y:0},this._popupPosition={x:0,y:0}}a.getViewportRect=function(){return{top:n.pageYOffset,left:n.pageXOffset,width:s.documentElement.clientWidth,height:s.documentElement.clientHeight}},a.isElementStatic=function(t){return"static"===n.getComputedStyle(t,null).getPropertyValue("position")},a.getParentOffset=function(){var t,e,n=0,i=0,o=this.getViewportRect();return this.isElementStatic(s.body)?(this.isElementStatic(s.documentElement)||(n+=(e=s.documentElement.getBoundingClientRect()).left+o.left,i+=e.top+o.top),{x:n,y:i}):{x:n+=(t=s.body.getBoundingClientRect()).left+o.left,y:i+=t.top+o.top}},a.prototype.moveTo=function(t,e){this._element.style.top=e+"px",this._element.style.left=t+"px"},a.prototype.getElementRect=function(){return this._element.getBoundingClientRect()},a.prototype.isSizeValid=function(t){var e=this.getElementRect();return t.height!==e.height||t.width!==e.width},a.prototype.calculatePosition=function(t,e,n){var i=0,o=0;t.forEach(function(t,e){i=0<e?Math.min(i,t.left):t.left,o=0<e?Math.max(o,t.bottom):t.bottom}),i+e.width>n.width&&(i=n.width-e.width),o+e.height>n.height&&(o=n.height-e.height),this._popupPosition.x=i,this._popupPosition.y=o},a.prototype.updatePosition=function(t){var e=this.getElementRect(),n=a.getViewportRect(),i=a.getParentOffset(),o=this.calculatePosition(t,e,n);return this.moveTo(this._popupPosition.x+n.left-i.x,this._popupPosition.y+n.top-i.y),this.isSizeValid(e)&&(o=this.updatePosition(t)),o},a.prototype.setPointerCoords=function(t,e){this._pointer.x=t,this._pointer.y=e};function o(t){var e,n;this._showTimer=0,this._hideTimer=0,t=t||{},this.setElement(t.element),this._spanType=t.spanType||"",this._hideDelay=t.hideDelay||o.DEFAULT_HIDE_DELAY,this._showDelay=t.showDelay||o.DEFAULT_SHOW_DELAY,this._inputElement=t.inputElement||s.createElement("input"),this._contentElement=t.contentElement||s.createElement("div"),this._positionBehavior=t.positionBehavior||new a(this._element),this._handleDocumentEvent=(e=this._handleDocumentEvent,n=this,function(){return e.apply(n,arguments)}),this._updateDocumentEvents()}o.ACTION_OPEN="open",o.ACTION_SEND="send",o.ACTION_CLOSE="close",o.ACTION_CLICK_CLOSE="clickClose",o.ACTION_EXPAND="expand",o.STATE_DISABLED="disabled",o.STATE_EXPANDED="expanded",o.STATE_HIDDEN="hidden",o.STATE_INVALID="invalid",o.STATE_POSITION="position",o.STATE_SUBMITTED="submitted",o.STATE_TRANSLATION="translation",o.DEFAULT_SHOW_DELAY=800,o.DEFAULT_HIDE_DELAY=400,o.PositionBehavior=a,o.prototype.show=function(t){var e=this;n.clearTimeout(this._hideTimer),t&&t!==this._spanIndex&&!this.isExpanded()&&(this._showTimer=n.setTimeout(function(){e.setIndex(t)},this._showDelay))},o.prototype.hide=function(t){var e=this;n.clearTimeout(this._showTimer),this.isHidden()||this.isExpanded()&&!t||(this._hideTimer=n.setTimeout(function(){e.setIndex()},t?0:this._hideDelay))},o.prototype.onAction=function(){},o.prototype.isHidden=function(){return"true"===this.getData(o.STATE_HIDDEN)},o.prototype.setFocus=function(t){this._inputElement[t?"focus":"blur"]()},o.prototype.setInputScroll=function(t,e){this._inputElement.scrollTop=t,this._inputElement.scrollLeft=e},o.prototype.getValue=function(){return this._inputElement.value.trim()},o.prototype.setValue=function(t){this._inputElement.value=t},o.prototype.getSpans=function(){return this._spanType&&this._spanIndex?Array.apply(null,s.querySelectorAll('[data-type="'+this._spanType+'"][data-index="'+this._spanIndex+'"]')):[]},o.prototype.setIndex=function(t){var e="",n="";this.highlightIndex(),(this._spanIndex=t)&&(this.getSpans().forEach(function(t){e+=t.getAttribute("data-value"),n+=t.getAttribute("data-translation")}),n=n.trim(),this.setData(o.STATE_TRANSLATION,n),this.setValue(n),this.setContent(e.trim()),this.highlightIndex(!0),this.updatePosition(),this.handleAction(o.ACTION_OPEN))},o.prototype.getData=function(t){return this._element.getAttribute("data-"+t)},o.prototype.setData=function(t,e){var n=this.getData(t);this._element.setAttribute("data-"+t,e),n!==this.getData(t)&&this.onDataChange(t,e)},o.prototype.isInvalid=function(){return"true"===this.getData(o.STATE_INVALID)},o.prototype.getContent=function(){return this._contentElement.textContent},o.prototype.setContent=function(t){this._contentElement.textContent=t},o.prototype.setInvalid=function(t){this.setData(o.STATE_INVALID,!!t)},o.prototype.setElement=function(t){var n=this;(t=this._element=t||s.createElement("div")).addEventListener("input",function(){var t=n.getValue();n.setInvalid(!t||t===n.getTranslation())},!1),t.addEventListener("click",function(t){var e=i(t.target,function(t){return t.hasAttribute("data-action")});e&&n.handleAction(e.getAttribute("data-action"))},!1),t.addEventListener("mouseout",function(){n.hide()},!1),t.addEventListener("mouseover",function(){n.show()},!1)},o.prototype.handleAction=function(t){var e={};switch(t){case o.ACTION_SEND:if(this.isInvalid())return;e.text=this.getContent(),e.proposal=this.getValue(),e.translation=this.getTranslation();break;case o.ACTION_CLOSE:this.hide(!0);break;case o.ACTION_EXPAND:e.expanded=this.toggleExpand(),this.updatePosition()}this.onAction(t,e)},o.prototype.isExpanded=function(){return"true"===this.getData(o.STATE_EXPANDED)},o.prototype.isDisabled=function(){return"true"===this.getData(o.STATE_DISABLED)},o.prototype.setValueDir=function(t){this._inputElement.dir=t},o.prototype.setDisabled=function(t){this.setData(o.STATE_DISABLED,!!t),this._updateDocumentEvents()},o.prototype.toggleExpand=function(t){var e=arguments.length?!!t:!this.isExpanded();return this.setData(o.STATE_EXPANDED,e),e},o.prototype.onDataChange=function(){},o.prototype.setContentDir=function(t){this._contentElement.dir=t},o.prototype.highlightIndex=function(e){this.setInvalid(!0),this.toggleExpand(!1),this.setData(o.STATE_HIDDEN,!e),this.getSpans().forEach(function(t){t.setAttribute("data-selected",!!e)})},o.prototype.getTranslation=function(){return this.getData(o.STATE_TRANSLATION)||""},o.prototype.updatePosition=function(){var t=this._positionBehavior.updatePosition(this.getSpans().map(function(t){return t.getBoundingClientRect()}));t&&this.setData(o.STATE_POSITION,t)},o.prototype._handlePointerEvent=function(t){this._positionBehavior.setPointerCoords(t.clientX,t.clientY)},o.prototype._handleDocumentEvent=function(t){var e=this._spanType,n=i(t.target,function(t){return t.getAttribute("data-type")===e});n&&("mouseout"===t.type?this.hide():(this.show(n.getAttribute("data-index")),this.isExpanded()||this._handlePointerEvent(t)))},o.prototype._updateDocumentEvents=function(){var t=(this.isDisabled()?"remove":"add")+"EventListener";s[t]("mouseout",this._handleDocumentEvent,!1),s[t]("mouseover",this._handleDocumentEvent,!1)},t.PageTranslatorPopup=o}(this,this.document,this.yt=this.yt||{});