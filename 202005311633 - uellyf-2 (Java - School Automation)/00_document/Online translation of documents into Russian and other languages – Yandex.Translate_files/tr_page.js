!function(u,f,t){"use strict";function h(){}var T={slice:function(t,e,n){return Array.prototype.slice.call(t,e,n)},toNum:function(t){return+t||0},isFunc:function(t){return"function"==typeof t},hasText:function(t){return!!t&&/[a-zA-Z\u00c0-\uffef]/.test(t)},isFrame:function(t){return t&&this.frameTags[t.nodeName]},RTLLangs:{ar:!0,fa:!0,he:!0,ur:!0,yi:!0},debounce:function(n,r){var i;return r=r||100,function(){var t=this,e=arguments;return u.clearTimeout(i),i=u.setTimeout(function(){n.apply(t,e)},r),this}},bindFunc:function(t,e){return function(){return t.apply(e,arguments)}},setZeroDelayTimeout:function(t){u.setTimeout(t,0)},inherits:function(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t},getStyle:function(t){return u.getComputedStyle(t,null)||t.style},isInline:function(t){var e=this.getStyle(t);return"inline"===e.display&&"static"===e.position},isInvisible:function(t,e){var n=t.getBoundingClientRect(),r=this.viewportHeight*T.toNum(e);return n.right<0||n.bottom<-r||n.top>this.viewportHeight+r||n.left>this.viewportWidth},frameTags:{FRAME:!0,IFRAME:!0},breakText:function(t,e){for(var n,r=[];t;)n=this.truncateText(t,e),r.push(n),t=t.slice(n.length);return r},escapeHTML:function(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")},sendRequest:function(t){var e,n=(t=t||{}).url||"/",r=t.body||null,i=t.params||"",s=t.method||"GET",a=t.timeout||5e3,o=t.callback||h;return(e=new u.XMLHttpRequest).onload=e.onerror=e.ontimeout=function(t){this.response?o(null,this.response):o(new Error(t.type))},i&&(n+=n.indexOf("?")<0?"?":"&",n+=this.toQueryString(i)),e.open(s,n),e.timeout=a,e.responseType="json",r&&(r=this.toQueryString(r),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded")),e.send(r),e},getDirection:function(t){return this.RTLLangs[t]?"rtl":"ltr"},unescapeHTML:function(t){return t.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&apos;/g,"'")},truncateText:function(t,e){var n,r,i=0;if(t.length<=e)return t;for(r=t.slice(0,e);n=this.truncationRules[i++];)if(n.test(r)){t=r.split(n).slice(0,-1).join("");break}return t},viewportWidth:u.innerWidth,viewportHeight:u.innerHeight,truncationRules:[/(\n+)/,/([.!?;](?:\s+|$))/,/([\-\u2012-\u2015](?:\s+|$))/,/([,:](?:\s+|$))/,/([\u3002\uff01\uff1f\uff1b\u2026])/,/([\uff0c\uff1a])/,/(\s+)/],isButtonInput:function(t){return t&&"INPUT"===t.nodeName&&this.buttonInputTypes[t.type]},toQueryString:function(t){var e,n,r,i,s=[];if(!t)return"";for(r in t)for(i=t[r],Array.isArray(i)||(i=[i]),r=u.encodeURIComponent(r),e=0,n=i.length;e<n;e++)s.push(null==i[e]?r:r+"="+u.encodeURIComponent(i[e]));return s.join("&")},getBrowserLang:function(){var t=u.navigator.language||u.navigator.userLanguage||"";return this.normalizeLang(t)},normalizeLang:function(t){return t?t.trim().split("-")[0].toLowerCase():t},createPlainObj:function(e){var n=Object.create(null);return e&&Object.keys(e).forEach(function(t){n[t]=e[t]}),n},normalizeValue:function(t){return t.replace(/[ \t\u00a0\u2000-\u200a\u3000]+/g," ")},buttonInputTypes:{reset:!0,submit:!0,button:!0},sendScriptRequest:function(t){return new _((t=t||{}).url,t).send(t.params,t.callback)}};u.addEventListener("resize",T.debounce(function(){T.viewportWidth=u.innerWidth,T.viewportHeight=u.innerHeight}));function i(){this._handlers=T.createPlainObj()}var o=1,l=3,c=12;i.prototype.on=function(t,e){var n=this._handlers;return t&&T.isFunc(e)&&(n[t]=n[t]||[]).push(e),this},i.prototype.off=function(t,e){var n,r,i=arguments.length,s=this._handlers[t];if(!s)return i||(this._handlers=T.createPlainObj()),this;if(1===i)return delete this._handlers[t],this;for(n=0,r=s.length;n<r;n++)if(s[n]===e){s.splice(n,1);break}return this},i.prototype.emit=function(t){var e,n,r=T.slice(arguments,1),i=this._handlers[t];if(i)for(e=0,n=(i=T.slice(i)).length;e<n;e++)i[e].apply(this,r);return this};function s(t){if(!t)throw new Error("Invalid request URL!");i.call(this),this._url=t,this._data=null,this._headers=T.createPlainObj()}T.inherits(s,i),s.METHOD_GET="GET",s.METHOD_POST="POST",s.DEFAULT_TIMEOUT=5e3,s.HEADER_CONTENT_TYPE="Content-Type",s.CONTENT_TYPE_JSON="application/json",s.RESPONSE_TYPE_JSON="json",s.EVENTNAME_LOAD="load",s.EVENTNAME_ERROR="error",s.EVENTNAME_TIMEOUT="timeout",s.EVENTNAME_RESPONSE="response",s.prototype.send=function(){var t,e=s.serializeData(this._data,this.getType()),n=this._request=new XMLHttpRequest;for(t in n.addEventListener(s.EVENTNAME_LOAD,this,!1),n.addEventListener(s.EVENTNAME_ERROR,this,!1),n.addEventListener(s.EVENTNAME_TIMEOUT,this,!1),n.open(this._method||s.METHOD_GET,this._buildUri()),this._headers)n.setRequestHeader(t,this._headers[t]);n.timeout=this._timeout||s.DEFAULT_TIMEOUT,n.responseType=s.RESPONSE_TYPE_JSON,n.send(e)},s.prototype.abort=function(){this._request&&this._request.abort(),this.destroy()},s.prototype.destroy=function(){var t=this._request;this.off(),t&&(t.removeEventListener(s.EVENTNAME_LOAD,this,!1),t.removeEventListener(s.EVENTNAME_ERROR,this,!1),t.removeEventListener(s.EVENTNAME_TIMEOUT,this,!1),this._request=null)},s.prototype.getType=function(){return this._headers[s.HEADER_CONTENT_TYPE]},s.prototype.setType=function(t){return this.setHeader(s.HEADER_CONTENT_TYPE,t)},s.prototype.setHeader=function(t,e){return this._headers[t]=e,this},s.prototype.setData=function(t){return this._data=t,this},s.prototype.setMethod=function(t){return this._method=t,this},s.prototype.setParams=function(t){return this._params=T.createPlainObj(t),this},s.prototype.setTimeout=function(t){return this._timeout=T.toNum(t),this},s.prototype.handleEvent=function(t){var e,n=t.target,r=n.response?(e=n.response,s.EVENTNAME_RESPONSE):(e=new Error(t.type),s.EVENTNAME_ERROR);this.emit(r,e).destroy()},s.prototype._buildUri=function(){var t=this._url,e=this._params;return e&&(t+=t.indexOf("?")<0?"?":"&",t+=T.toQueryString(e)),t},s.serializeData=function(t,e){switch(e){case s.CONTENT_TYPE_JSON:return JSON.stringify(t);default:return t}};function r(){this.setParams()}r.prototype.getParam=function(t){return this._params[t]},r.prototype.setParam=function(t,e){this._params[t]=e},r.prototype.setParams=function(t){this._params=T.createPlainObj(t)};function m(t,e){r.call(this),this._node=t,e&&this.setParams(e)}T.inherits(m,r),m.prototype.getNode=function(){return this._node},m.prototype.getValue=function(){return this._node.parentNode?this._node.nodeValue:""},m.prototype.setValue=function(t){this._node.parentNode&&(this._node.nodeValue=t)};function a(){m.apply(this,arguments)}T.inherits(a,m),a.PARAM_ATTR="attr",a.prototype.getValue=function(){return this._node.getAttribute(this.getParam(a.PARAM_ATTR))},a.prototype.setValue=function(t){this._node.setAttribute(this.getParam(a.PARAM_ATTR),t)};function N(t,e,n){r.call(this),this._type=t||N.TYPE_TEXT,this._spans=e||[],n&&this.setParams(n)}T.inherits(N,r),N.TYPE_ATTR="attr",N.TYPE_TEXT="text",N.splitSpan=function(t,e){var n,r,i=t.getNode(),s=T.breakText(t.getParam("value"),e),a=[],o=s.length;if(1===o)return a;for(r=f.createDocumentFragment(),n=0;n<o;n++)r.appendChild(f.createTextNode(s[n])),s[n].length>e||a.push(new N(N.TYPE_TEXT,[new m(r.lastChild,{value:s[n]})]));return i.parentNode.replaceChild(r,i),a},N.breakChunk=function(t,e){for(var n,r=0,i=t.getSpans(),s=[],a=new N,o=0,u=i.length;o<u;o++)e<r+(n=i[o].getParam("value").length)&&(r&&(r=0,s.push(a),a=new N),e<n)?s=s.concat(this.splitSpan(i[o],e)):(r+=n,a.addSpan(i[o]));return r&&s.push(a),s},N.prototype.getType=function(){return this._type},N.prototype.setType=function(t){this._type=t},N.prototype.addSpan=function(t){this._spans.push(t)},N.prototype.getSpan=function(t){return this._spans[t]},N.prototype.setSpan=function(t,e){this._spans[t]=e},N.prototype.getSpans=function(){return this._spans.slice()},N.prototype.getValue=function(t){for(var e=[],n=this.getSpans(),r=0,i=n.length;r<i;r++)e.push(n[r].getValue());return t?e.join(""):e},N.prototype.setValue=function(t){for(var e=this.getSpans(),n=0,r=e.length;n<r;n++)e[n].setValue(t[n])},N.prototype.getLength=function(){return this._spans.length};function p(t){t=t||{},r.call(this),this._filters=t.filters||[],this._element=t.element||f.documentElement,this._highAccuracy=!!t.highAccuracy,this.reset()}T.inherits(p,r),p.nodeAttributes=T.createPlainObj({TRANSLATE:"translate",LANG:"lang",SRC_LANG:"data-srclang"}),p.ATTRS=T.createPlainObj({alt:!0,abbr:!0,title:!0,label:!0,value:function(t){return T.isButtonInput(t)&&!t.name},content:function(t){var e,n=!1;return"META"===t.nodeName&&(n=0<=(e=t.getAttribute("property")||t.name).indexOf("title")||0<=e.indexOf("description")),n},placeholder:!0,"aria-label":!0}),p.INLINE_TAGS=T.createPlainObj({A:!0,B:!0,I:!0,Q:!0,S:!0,U:!0,BR:!0,EM:!0,RP:!0,RT:!0,TT:!0,BDI:!0,BDO:!0,BIG:!0,DEL:!0,DFN:!0,IMG:!0,INS:!0,KBD:!0,MAP:!0,SUB:!0,SUP:!0,SVG:!0,VAR:!0,WBR:!0,ABBR:!0,CITE:!0,CODE:!0,DATA:!0,MARK:!0,MATH:!0,RUBY:!0,SAMP:!0,SPAN:!0,TIME:!0,AUDIO:!0,INPUT:!0,LABEL:!0,METER:!0,SMALL:!0,BUTTON:!0,SELECT:!0,STRONG:!0,ACRONYM:!0,PICTURE:!0,PROGRESS:!0,TEXTAREA:!0}),p.SERVICE_TAGS=T.createPlainObj({BASE:!0,LINK:!0,META:!0,STYLE:!0,SCRIPT:!0,NOSCRIPT:!0,TEMPLATE:!0}),p.INVALID_TAGS=T.createPlainObj({SVG:!0,MATH:!0,RUBY:!0,AUDIO:!0,EMBED:!0,VIDEO:!0,CANVAS:!0,OBJECT:!0,PROGRESS:!0,TEXTAREA:!0}),p.NOT_TRANSLATABLE_TAGS=T.createPlainObj({KBD:!0,VAR:!0,CODE:!0,SAMP:!0,ADDRESS:!0}),p.NOT_WRAPABLE_TAGS=T.createPlainObj({TITLE:!0}),p.isValidNodeName=function(t){var e;return!!t&&(e=t.toUpperCase(),!this.SERVICE_TAGS[e]&&!this.INVALID_TAGS[e]&&!this.NOT_TRANSLATABLE_TAGS[e])},p.isInlineNodeName=function(t){return!!t&&t.toUpperCase()in this.INLINE_TAGS},p.isTranslatableElement=function(t){for(;t&&t.nodeType===o;){if(!this.isValidNodeName(t.nodeName))return!1;if(t.hasAttribute(p.nodeAttributes.TRANSLATE))return"no"!==t.getAttribute(p.nodeAttributes.TRANSLATE);t=t.parentNode}return!0},p.changeElementDirAndAlign=function(e,n,r){u.setTimeout(function(){var t=T.getStyle(e);t.direction!==n&&(e.style.direction=n),t.textAlign!==r&&"center"!==t.textAlign&&(e.style.textAlign=r)},0)},p.prototype.reset=function(){this._chunks=[],this._currentChunk=new N,this._processedElements=[]},p.prototype.update=function(){var t,e,n,r=this._filters,i=this.getChunks();for(this.reset(),this._parseNode(this._element),n=this.getChunks(),t=0,e=r.length;t<e;t++)n=r[t](n,i)||[];this._chunks=n},p.prototype.getDir=function(){var t=this._element;return t.dir||T.getStyle(t).direction},p.prototype.getLang=function(){return this._element.lang.split("-")[0]},p.prototype.setLang=function(t,e){for(var n,r=T.getDirection(t),i="ltr"===r?"left":"right",s=this._processedElements,a=0,o=s.length;a<o;a++)(n=s[a]).lang&&n.lang!==t&&(n.lang=t),e&&!p.SERVICE_TAGS[n.nodeName]&&p.changeElementDirAndAlign(n,r,i);return this},p.prototype.addChunk=function(t){this._chunks.push(t)},p.prototype.getChunk=function(t){return this._chunks[t]},p.prototype.setChunk=function(t,e){this._chunks[t]=e},p.prototype.getValue=function(t){for(var e=[],n=this.getChunks(),r=0,i=n.length;r<i;r++)e.push(n[r].getValue(t));return t?e.join(""):e},p.prototype.getChunks=function(){return this._chunks.slice()},p.prototype.getLength=function(){return this._chunks.length},p.prototype.getElement=function(){return this._element},p.prototype._parseNode=function(t,e){var n,r,i,s,a;if(t)switch(t.nodeType){case l:if(r=t.nodeValue,e||!r.trim())return;return void this._currentChunk.addSpan(new m(t,{value:r}));case o:if(""===(a=t.getAttribute(p.nodeAttributes.TRANSLATE))&&(a="yes"),(e=p.NOT_TRANSLATABLE_TAGS[t.nodeName]||"no"===a||!!e&&"yes"!==a)||(this._extractAttrs(t),this._processedElements.push(t)),(i=this._highAccuracy?T.isInline(t):p.isInlineNodeName(t.nodeName))||this._flushChunk(),p.isValidNodeName(t.nodeName)){if(!(s=t.getAttribute(p.nodeAttributes.SRC_LANG)||t.getAttribute(p.nodeAttributes.LANG))||i||e||t===this._element||(t.setAttribute(p.nodeAttributes.SRC_LANG,s),this._currentChunk.setParam("lang",s)),T.isFrame(t))return this._parseFrame(t,e);for(t.shadowRoot&&this._parseNode(t.shadowRoot,e),n=t.firstChild;n;n=n.nextSibling)this._parseNode(n,e);i||this._flushChunk()}return;case c:for(n=t.firstChild;n;n=n.nextSibling)this._parseNode(n,e);return}},p.prototype._parseFrame=function(t,e){t.src;try{this._parseNode(t.contentDocument.body,e)}catch(t){}},p.prototype._flushChunk=function(){var t=this._currentChunk;return 0<t.getLength()&&(T.hasText(t.getValue(!0))&&this.addChunk(t),this._currentChunk=new N),this._currentChunk},p.prototype._extractAttrs=function(t){var e,n,r;for(e in p.ATTRS)n=t.getAttribute(e),T.hasText(n)&&(r=p.ATTRS[e],T.isFunc(r)&&!r(t)||this.addChunk(new N(N.TYPE_ATTR,[new a(t,{attr:e,value:n})])));return this};var _=function(t,e){e=e||{},this._src=t,this._timeout=e.timeout||5e3,this._callbackName=e.callbackName||"callback"};_.counter=0,_.generateId=function(){return"_"+(this.counter++).toString(36)},_.STORAGE_KEY="_"+Date.now().toString(36)+"_",_.prototype.send=function(t,e){var n=this._id=_.generateId(),r=this._src,i=this,s=this._script=f.createElement("script");return(t=t||{})[this._callbackName]=[_.STORAGE_KEY,n].join("."),e=e||h,u[_.STORAGE_KEY]=u[_.STORAGE_KEY]||T.createPlainObj(),s.src=r+(r.indexOf("?")<0?"?":"&")+T.toQueryString(t),s.onerror=function(){i._cleanup(),e(new Error("Network error!"))},u[_.STORAGE_KEY][n]=function(t){i._cleanup(!0),e(null,t)},this._timer=u.setTimeout(s.onerror,this._timeout),f.head.appendChild(s),this},_.prototype.abort=function(){return this._cleanup(!1)},_.prototype._cleanup=function(t){var e=this._id,n=this._script;return n&&(u.clearTimeout(this._timer),t?delete u[_.STORAGE_KEY][e]:u[_.STORAGE_KEY][e]=h,n.onerror=null,n.parentNode&&n.parentNode.removeChild(n),this._script=null),this};function g(t){t=t||{},this._key=t.key,this._srv=t.srv,this._sid=t.sid||g.generateSid(),this._url=t.url||"/",this._format=t.format,this._useXHR=t.useXHR,this._timeout=T.toNum(t.timeout),this._options=T.toNum(t.options),this._requests=T.createPlainObj(),this._detectUrl=t.detectUrl,this._extraParams=T.createPlainObj(t.extraParams),this._requestCounter=0}g.OK=200,g.FORMAT_HTML="html",g.MAX_TEXT_LENGTH=1e4,g.generateSid=function(){for(var t=Date.now().toString(16),e=0,n=16-t.length;e<n;e++)t+=Math.floor(16*Math.random()).toString(16);return t},g.isValidLang=function(t){return"und"!==t&&/^[a-z]{2,6}$/.test(t)},g.prototype.abort=function(){var t,e=this._requests;for(t in e)e[t].abort();return this._requests=T.createPlainObj(),this},g.prototype.getSid=function(){return this._sid},g.prototype.setExtraParam=function(t,e){this._extraParams[t]=e},g.prototype.getExtraParam=function(t){return this._extraParams[t]},g.prototype.getParams=function(t,e){var n=T.createPlainObj(this._extraParams);return n.id=[this._sid,this._requestCounter,0].join("-"),this._key&&(n.key=this._key),this._srv&&(n.srv=this._srv),n.text=t,n.lang=e,this._format&&(n.format=this._format),this._options&&(n.options=this._options),n},g.prototype.translate=function(t,e,n){var r,i=this._requests;return!t||t.join("").length>g.MAX_TEXT_LENGTH?n(new Error("Invalid text!")):(r=this.getParams(t,e),i[r.id]=T[this._useXHR?"sendRequest":"sendScriptRequest"]({url:this._url,params:r,timeout:this._timeout,callback:function(t,e){delete i[r.id],e&&e.code!==g.OK&&(t=new Error(e.message),e=null),n(t,e)}}),this._requestCounter+=1,this)},g.prototype.detectLang=function(t,e,n){this._detectRequest&&this._detectRequest.abort(),this._detectRequest=new s(this._detectUrl),this._detectRequest.on(s.EVENTNAME_ERROR,function(t){n(t)}).on(s.EVENTNAME_RESPONSE,function(t){t.code===g.OK?n(null,t):n(new Error(t.message))}).setParams({sid:this._sid,srv:this._srv,text:t,hint:e.join(",")}).setTimeout(this._timeout).send()};function E(t){i.call(this),this._target=t,this.handleEvent=T.debounce(this.handleEvent)}T.inherits(E,i),E.prototype.observe=function(){this._target.addEventListener("scroll",this,!0)},E.prototype.hibernate=function(){this._target.removeEventListener("scroll",this,!0)},E.prototype.handleEvent=function(t){this.emit(t.type)};function d(t,e){i.call(this),this._element=t,this._options=e||d.DEFAULT_OPTIONS,this._observer=new u.MutationObserver(T.bindFunc(this._handleData,this))}T.inherits(d,i),d.canUse=function(){return"MutationObserver"in u},d.TYPE_CHILDLIST="childList",d.TYPE_ATTRIBUTES="attributes",d.TYPE_CHARACTERDATA="characterData",d.DEFAULT_OPTIONS={subtree:!0,childList:!0,attributes:!0,characterData:!0},d.prototype.observe=function(){return this._active=!0,this._observer.observe(this._element,this._options),this},d.prototype.hibernate=function(){return this._active=!1,this._observer.disconnect(),this},d.prototype._handleData=function(t){this._active&&this.emit("modify",t)};function A(t,e){i.call(this),this._element=t,this._timeout=e||5e3,this._interval=0,this._checkContent=T.bindFunc(this._checkContent,this)}T.inherits(A,i),A.prototype.observe=function(){return this._interval||(this._content=this._element.textContent,this._interval=u.setInterval(this._checkContent,this._timeout)),this},A.prototype.hibernate=function(){return u.clearInterval(this._interval),this._interval=0,this},A.prototype._checkContent=function(){var t=this._element.textContent;this._content!==t&&(this._content=t,this.emit("modify",null))};function y(t){var e,n=this,r=[];i.call(this),(t=t||{}).format=g.FORMAT_HTML,r.push(T.bindFunc(this._syncChunks,this)),r.push(T.bindFunc(this._breakChunks,this)),r.push(T.bindFunc(this._sortChunksByLang,this)),t.checkVisibility&&(r.push(y.markInvisibleChunksOnNearbyScreens(t.preTranslateScreens)),this._scrollObserver=new E(u),this._scrollObserver.on("scroll",T.bindFunc(this.sync,this))),t.filters=r.concat(t.filters||[]),this._alignChunkCounter=0,this._pageModel=new p(t),this._textTranslator=new g(t),this._maxThreads=t.maxThreads||5,this._maxPortionItems=t.maxPortionItems||20,this._maxPortionErrors=t.maxPortionErrors||2,this._maxPortionLength=t.maxPortionLength||1e3,this._useLangAttribute=t.useLangAttribute,this._debouncedSync=T.debounce(this.sync,200),this._isModifiedObserverData=!1,t.autoSync&&(e=this._pageModel.getElement(),d.canUse()?this._modifyObserver=new d(e):this._modifyObserver=new A(e,t.autoSyncInterval),this._modifyObserver.on("modify",function(t){t?(n._isModifiedObserverData||(n._isModifiedObserverData=y.isValidObserverData(t)),n._isModifiedObserverData&&n._debouncedSync()):n.sync()}))}T.inherits(y,i),y.DELIMITER="<wbr>",y.SPAN_TYPE="trSpan",y.SPAN_TAGNAME="ya-tr-span",y.EVENTNAME_CLOSE="close",y.EVENTNAME_ABORT="abort",y.EVENTNAME_ERROR="error",y.EVENTNAME_DETECT="detect",y.EVENTNAME_COMPLETE="complete",y.EVENTNAME_PROGRESS="progress",y.EVENTNAME_PORTION_ERROR="portionError",y.EVENTNAME_PORTION_PROGRESS="portionProgress",y.MAX_ALIGN_LENGTH=1e9,y.wrapSpan=function(t){var e=t.getNode(),n=t.getValue(),r=e.parentNode.getAttribute("data-type")===this.SPAN_TYPE,i=t.getParam("value"),s=r?e.parentNode:f.createElement(this.SPAN_TAGNAME);return s.setAttribute("data-index",t.getParam("index")),s.setAttribute("data-value",T.normalizeValue(i)),s.setAttribute("data-translation",T.normalizeValue(n)),r||(s.textContent=n,s.setAttribute("data-type",this.SPAN_TYPE),e.parentNode.replaceChild(s,e),e=s.firstChild),r?t:new m(e,{value:i,translated:!0,translation:n})},y.parseAlign=function(t){var e,n,r;if(!t)return[];for(e=0,n=(t=t.split(";")).length;e<n;e++)(r=(r=t[e]).split("-"))[0]=r[0].split(":"),r[1]=r[1].split(":"),r[0][0]=+r[0][0],r[0][1]=+r[0][1]+r[0][0],r[1][0]=+r[1][0],r[1][1]=+r[1][1]+r[1][0],0===e?r[0][0]=r[1][0]=0:(t[e-1][0][1]=r[0][0],t[e-1][1][1]=r[1][0]),t[e]=r;return t},y.prepareValue=function(t){for(var e=t.length,n=0;n<e;n++)t[n]=T.escapeHTML(T.normalizeValue(t[n]));return t.join(this.DELIMITER)},y.parseTranslation=function(t){for(var e=0,n=(t=t.split(this.DELIMITER)).length;e<n;e++)t[e]=T.unescapeHTML(t[e]);return t},y.isChunkInvisible=function(t){return this.isChunkIncludeParam(t,"invisible")},y.isChunkTranslated=function(t){return this.isChunkIncludeParam(t,"translated")},y.isChunkIncludeParam=function(t,e){for(var n=0,r=t.getSpans(),i=r.length;n<i&&r[n].getParam(e);)n++;return n===i},y.isValidObserverData=function(t){for(var e=t.length,n=0;n<e;n++)if(T.hasText(this.getValidMutationRecordValue(t[n])))return!0;return!1},y.getValidMutationRecordValue=function(t){var e="",n=t.target,r=[];switch(t.type){case d.TYPE_CHILDLIST:T.slice(t.addedNodes).forEach(function(t){var e,n=t.nodeType;n!==l&&n!==o||(e=n===l?t.parentNode:t,p.isTranslatableElement(e)&&r.push(t.textContent))}),e=r.join("");break;case d.TYPE_ATTRIBUTES:t.attributeName in p.ATTRS&&p.isTranslatableElement(n)&&(e=n.getAttribute(t.attributeName));break;case d.TYPE_CHARACTERDATA:n.nodeType===l&&p.isTranslatableElement(n.parentNode)&&(e=n.data)}return e},y.getChunkValueLength=function(t){for(var e=0,n=t.getSpans(),r=0,i=n.length;r<i;r++)e+=n[r].getParam("value").length;return e},y.getChunkAncestorNode=function(t){var e=t.getSpan(0).getNode();for(e.nodeType!==o&&(e=e.parentNode);e&&p.isInlineNodeName(e.nodeName);)e=e.parentNode;return e},y.markInvisibleChunks=function(t,e,r){return t.forEach(function(t){var e,n;y.isChunkTranslated(t)||(e=y.getChunkAncestorNode(t))&&e.nodeType===o&&(n=T.isInvisible(e,r),t.getSpans().forEach(function(t){t.setParam("invisible",n)}))}),t},y.markInvisibleChunksOnNearbyScreens=function(n){return function(t,e){return y.markInvisibleChunks(t,e,n)}},y.isWrapableChunk=function(t){var e=this.getChunkAncestorNode(t);return t.getType()===N.TYPE_TEXT&&!p.NOT_WRAPABLE_TAGS[e&&e.nodeName]},y.patchAlign=function(t){var e=t.length-1;t[e][1][1]=t[e][0][1]=this.MAX_ALIGN_LENGTH},y.prototype.halt=function(){return this.abort(),this._modifyObserver&&this._modifyObserver.hibernate(),this._scrollObserver&&this._scrollObserver.hibernate(),this},y.prototype.sync=function(){return this.halt(),this.translate(this._sourceLang,this._targetLang),this._isModifiedObserverData=!1,this},y.prototype.undo=function(){var t,e,n,r,i,s,a,o,u=this._pageModel;for(this.halt(),t=0,n=(a=u.getChunks()).length;t<n;t++)for(e=0,r=(s=a[t].getSpans()).length;e<r;e++)(i=s[e]).setParam("translated",!1),i.setValue(i.getParam("value"));return(o=this.getSourceLang())&&u.setLang(o,T.getDirection(o)!==T.getDirection(this._targetLang)),this},y.prototype.redo=function(){var t,e,n,r,i,s,a,o;for(this.halt(),t=0,n=(a=this._pageModel.getChunks()).length;t<n;t++)for(e=0,r=(s=a[t].getSpans()).length;e<r;e++)(o=(i=s[e]).getParam("translation"))&&(i.setValue(o),i.setParam("translated",!0));return this.translate(this._sourceLang,this._targetLang)},y.prototype.abort=function(){return this._textTranslator.abort(),this.emit(y.EVENTNAME_ABORT)},y.prototype.translate=function(t,e){var n,r=this._pageModel,i=T.bindFunc(this._translateNext,this);if(t=t||"",e=e||T.getBrowserLang(),"auto"===t&&(t=""),!this._useLangAttribute&&t===e)return this.emit(y.EVENTNAME_COMPLETE);for(r.update(),this._index=0,this._length=r.getLength(),this._progress=0,this._direction=(t&&t+"-")+e,this._readyThreads=0,this._errorCounter=T.createPlainObj(),this.on(y.EVENTNAME_ABORT,this._handleEnd).on(y.EVENTNAME_COMPLETE,this._handleEnd).on(y.EVENTNAME_PORTION_ERROR,this._handleError).on(y.EVENTNAME_PORTION_PROGRESS,this._handleProgress),this._sourceLang=t,this._targetLang=e,r.setLang(e,r.getDir()!==T.getDirection(e)),this.emit(y.EVENTNAME_PROGRESS,0),n=0;n<this._maxThreads;n++)T.setZeroDelayTimeout(i);return this},y.prototype.applyAlign=function(){for(var t,e,n,r,i,s,a,o,u,h,l,c,p,_=this._pageModel,g=_.getChunks(),E=0,d=g.length;E<d;E++)if(y.isWrapableChunk(g[E])&&(s=y.parseAlign(g[E].getParam("align"))).length){for(y.patchAlign(s),o=c="",u=[n=0,0],h=[],t=0,e=(a=g[E].getSpans()).length;t<e;t++){for(i=a[t].getNode(),r=f.createDocumentFragment(),o+=a[t].getValue(),c+=T.normalizeValue(a[t].getParam("value"));s[n]&&u[1]<o.length;)l=o.slice(u[1],s[n][1][1]),p=c.slice(u[0],s[n][0][1]),r.appendChild(f.createTextNode(l)),h.push(new m(r.lastChild,{index:this._alignChunkCounter+"-"+n,value:p,translated:!0,translation:l})),u[1]+=l.length,u[0]+=p.length,u[1]===s[n][1][1]&&n++;r.hasChildNodes()&&i.parentNode.replaceChild(r,i)}for(t=0,e=h.length;t<e;t++)h[t]=y.wrapSpan(h[t]);_.setChunk(E,new N(N.TYPE_TEXT,h)),this._alignChunkCounter++}return this},y.prototype.setExtraParam=function(t,e){return this._textTranslator.setExtraParam(t,e),this},y.prototype.getExtraParam=function(t){return this._textTranslator.getExtraParam(t)},y.prototype.getSessionId=function(){return this._textTranslator.getSid()},y.prototype.getSourceLang=function(){var t,e,n,r,i,s,a,o,u;if(this._sourceLang)return this._sourceLang;for(s=T.createPlainObj(),u="",t=0,n=(o=this._pageModel.getChunks()).length;t<n;t++)for(e=0,r=(a=o[t].getSpans()).length;e<r;e++)(i=a[e].getParam("sourceLang"))&&(s[i]=T.toNum(s[i])+1);for(i in s)s[i]>T.toNum(s[u])&&(u=i);return u},y.prototype.getTargetLang=function(){return this._targetLang},y.prototype.detectSourceLang=function(){var t,e,n,r,i=this,s=[];for(this._pageModel.update(),t=0,e=(r=this._pageModel.getChunks()).length;t<e;t++)(n=r[t]).getType()===N.TYPE_TEXT&&s.push(n.getValue(!0));s=s.join(" ").replace(/\s+/g," ").slice(0,this._maxPortionLength),this._textTranslator.detectLang(s,T.slice(arguments),function(t,e){i.emit(y.EVENTNAME_DETECT,e?e.lang:"")})},y.prototype._syncChunks=function(t,e){var n,r,i,s,a,o,u,h,l,c=T.createPlainObj(),p=e.length;if(!p)return t;for(n=0;n<p;n++)for(r=0,i=(u=e[n].getSpans()).length;r<i;r++)(c[h=u[r].getValue()]=c[h]||[]).push(u[r]);for(n=0,p=t.length;n<p;n++)for(r=0,i=(u=t[n].getSpans()).length;r<i;r++)if(o=u[r].getNode(),l=c[h=u[r].getValue()])for(s=0,a=l.length;s<a;s++)if(o===l[s].getNode()&&h===l[s].getParam("translation")){t[n].setSpan(r,l[s]);break}return t},y.prototype._breakChunks=function(t){for(var e=[],n=0,r=t.length;n<r;n++)y.isChunkTranslated(t[n])||y.getChunkValueLength(t[n])<=this._maxPortionLength?e.push(t[n]):t[n].getType()===N.TYPE_TEXT&&(e=e.concat(N.breakChunk(t[n],this._maxPortionLength)));return e},y.prototype._sortChunksByLang=function(t){return t.sort(function(t,e){var n=t.getParam("lang")||"",r=e.getParam("lang")||"";return n.localeCompare(r)}),t},y.prototype._handleEnd=function(){this.off(y.EVENTNAME_ABORT,this._handleEnd).off(y.EVENTNAME_COMPLETE,this._handleEnd).off(y.EVENTNAME_PORTION_ERROR,this._handleError).off(y.EVENTNAME_PORTION_PROGRESS,this._handleProgress)},y.prototype._handleError=function(t){var e="_"+t.join(";");this._errorCounter[e]=T.toNum(this._errorCounter[e])+1,this._errorCounter[e]<=this._maxPortionErrors?this._translatePortion(t):this.emit(y.EVENTNAME_ERROR,t).emit(y.EVENTNAME_PORTION_PROGRESS,t)},y.prototype._handleProgress=function(t){this._progress+=t.length,this.emit(y.EVENTNAME_PROGRESS,Math.round(100/this._length*this._progress)),this._translateNext()},y.prototype._getNextPortion=function(){for(var t,e,n,r=this._pageModel.getChunks(),i=[],s=0,a=0,o=this._index,u=r.length;o<u&&s<this._maxPortionItems;o++)if(n=(t=r[o]).getParam("lang"),y.isChunkInvisible(t)||y.isChunkTranslated(t))this._progress+=1;else{if((a+=y.getChunkValueLength(t))>this._maxPortionLength&&s)break;if((this._useLangAttribute||!this._sourceLang)&&n)if(s){if(!e||e!==n)break}else e=n;s=i.push(o)}return this._index=o,i},y.prototype._translateNext=function(){var t=this._getNextPortion();return t.length?this._translatePortion(t):++this._readyThreads===this._maxThreads&&(this.emit(y.EVENTNAME_COMPLETE),T.setZeroDelayTimeout(T.bindFunc(this._startObserving,this))),this},y.prototype._startObserving=function(){this._modifyObserver&&this._modifyObserver.observe(),this._scrollObserver&&this._scrollObserver.observe()},y.prototype._translatePortion=function(n){for(var t,e,r,i,s,a,o,u=this,h=[],l=0,c=n.length;l<c;l++)if(i=this._pageModel.getChunk(n[l])){for(a=[],t=0,e=(r=i.getSpans()).length;t<e;t++)a[t]=r[t].getParam("value");h.push(y.prepareValue(a))}return h.length?(this._sourceLang&&!this._useLangAttribute||(s=this._pageModel.getChunk(n[0]),o=T.normalizeLang(s&&s.getParam("lang"))),o===this._targetLang||!o&&this._sourceLang===this._targetLang?this.emit(y.EVENTNAME_PORTION_PROGRESS,n):this._textTranslator.translate(h,g.isValidLang(o)?o+"-"+this._targetLang:this._direction,function(t,e){return t?u.emit(y.EVENTNAME_PORTION_ERROR,n):(u._setTranslation(n,e),void u.emit(y.EVENTNAME_PORTION_PROGRESS,n))}),this):this.emit(y.EVENTNAME_PORTION_PROGRESS,n)},y.prototype._setTranslation=function(t,e){for(var n,r,i,s,a,o,u=e.lang.split("-"),h=0,l=t.length;h<l;h++)if(a=this._pageModel.getChunk(t[h]))for(s=a.getSpans(),e.align&&a.setParam("align",e.align[h]),o=y.parseTranslation(e.text[h]),n=0,r=s.length;n<r;n++)(i=s[n]).setValue(o[n]),i.setParam("translated",!0),i.setParam("sourceLang",u[0]),i.setParam("translation",o[n]);return this},t.PageTranslator=y,t.Request=s}(window,window.document,window.yt=window.yt||{});